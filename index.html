<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>IRR Calculation Using Mongodb and C# (.net) by saidmohamedali</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">IRR Calculation Using Mongodb and C# (.net)</h1>
      <h2 class="project-tagline">IRR, mongodb, c#, .net, mongodb driver</h2>
      <a href="https://github.com/saidmohamedali/irrmongodb" class="btn">View on GitHub</a>
      <a href="https://github.com/saidmohamedali/irrmongodb/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/saidmohamedali/irrmongodb/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
<a id="irr-calculation-principles" class="anchor" href="#irr-calculation-principles" aria-hidden="true"><span class="octicon octicon-link"></span></a>IRR Calculation Principles.</h3>

<p>The Internal Rate of Return (IRR) materializes the rate of return generated for all uses of an authorization envelope implementation (financial headings and headings accessories) , that is to say, the return flow income and return of capital that was made ​​available to the client. This is called Global IRR(IRRG ) . It is calculated such that the present value (NPV) at the rate of outflow ( disbursement of capital) inflows ( principal and income attached ) equalizes .
That is to solve the folowing equation Q1:</p>

<p><img src="images/equation_irr.png" alt="IRR Equation"></p>

<dl>
<dt>with:</dt>
<dd>IRRG = overall internal rate of return</dd>
<dd>Fs (i) = net amount in currency of the outgoing stream No. i</dd>
<dd>n = number of outflows</dd>
<dd>Fe (i) = net amount in currency of the incoming stream No. i</dd>
<dd>m = number of inflows</dd>
<dd>di = the date of the incoming or outgoing stream No. i</dd>
<dd>d0 = the departure date of the measure: date of signing the contract.</dd>
<dd>base = reference period TRIG expression in rates , the year in days . The value is set to 365 or 366 by year of di .</dd>
<dd>VANs = Present Value Net outflows</dd>
<dd>Vane = Present Value Net inflows</dd>

</dl>

<h4>
<a id="solving-the-equation-q1" class="anchor" href="#solving-the-equation-q1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Solving the equation Q1</h4>

<p>Resolution Q1 is only feasible by a possible value of iteration IRRG in this equation.
In order to achieve a result and limit the number of test, it is necessary to introduce the following concepts:</p>

<dl>
<dt>Margin of error : ε</dt>
<dt>IRRG Lower Bound: LORRG</dt>
<dt>IRRG Upper Bound: UPIRRG</dt>
</dl>

<h5>
<a id="margin-of-error" class="anchor" href="#margin-of-error" aria-hidden="true"><span class="octicon octicon-link"></span></a>Margin of Error</h5>

<p>It defines the accuracy in which the calculation is performed in the Q1 equation. </p>

<dl>It is defined by the following relationship:
<dt>|VANs| - |VANe |
</dt>
</dl>

<h5>
<a id="irrg-lower-and-upper-bound" class="anchor" href="#irrg-lower-and-upper-bound" aria-hidden="true"><span class="octicon octicon-link"></span></a>IRRG Lower and upper Bound</h5>

<p>The objective of these two terminals is to frame the IRRG value to rapidly converge to the result.
The longer the interval between LOIRRG and UPIRRG is low with LOIRRG ≤ IRRG ≤ UPIRRG the more convergence will be fast . It is therefore necessary to fix the two terminals by the most appropriate values.
The research by dichotomy IRRG optimizes the resolution of the equation.</p>

<h3>
<a id="irr-calculation-schema-design" class="anchor" href="#irr-calculation-schema-design" aria-hidden="true"><span class="octicon octicon-link"></span></a>IRR Calculation Schema Design</h3>

<p>IIR calculations go through the collection of different types of flows. The nature of the stream sets the inbound or outbound direction of the latter.
Outflows are by definition disbursements  and Inflows are attached repayments and income.
Each flow belongs by nature to an allocation represented by the following concepts:</p>

<ul>
<li>expenditure</li>
<li>bills</li>
<li>Accessories items</li>
<li>Financial headings</li>
<li>Bonus flows</li>
<li>PEE flow</li>
</ul>

<p>In MongoDB we need a collection which contains all flows, so let call this collections flows.
We need also an IRR definition collection which contains IRR Name and Allocations. As each IRR definition will contain its allocations, it can be calculated by allocation and we easily see dependencies between IRR Definitions which can be represented as a Tree, for that we just need an ancesstor field into IRR definition collection.</p>

<p><img src="images/IRR_MONGODB_SCHEMA.png" alt="IRR Mongodb Schema Design"></p>

<p>Consider the following document that captures sample of IRR definition:</p>

<h3>
<a id="application-object-model" class="anchor" href="#application-object-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Application Object Model</h3>

<h4>
<a id="pre-requisites" class="anchor" href="#pre-requisites" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pre-requisites</h4>

<p>Please make sure all applications listed bellow are up-and-running on your machine, if not please feel free to get it from the correspondent editor website.
The application object model will be:</p>

<div class="highlight highlight-c#"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">IRRDefinition</span>
    {
        [BsonRepresentation(BsonType.ObjectId)]
        <span class="pl-k">public</span> ObjectId <span class="pl-en">Id</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
        <span class="pl-k">public</span> <span class="pl-k">string</span> <span class="pl-en">Name</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
        <span class="pl-k">public</span> <span class="pl-k">string</span> <span class="pl-en">Description</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }

        <span class="pl-k">public</span> List&lt;Allocation&gt; <span class="pl-en">Allocations</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
        <span class="pl-k">public</span> List&lt;ObjectId&gt; <span class="pl-en">Ancestors</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }

        <span class="pl-k">public</span> <span class="pl-en">IRRDefinition</span>()
        {
            Allocations = <span class="pl-k">new</span> List&lt;Allocation&gt;();
            Ancestors = <span class="pl-k">new</span> List&lt;ObjectId&gt;();
        }
    }


 <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Flow</span>
    {

        [BsonRepresentation(BsonType.ObjectId)]
        <span class="pl-k">public</span> ObjectId <span class="pl-en">Id</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
        <span class="pl-k">public</span> <span class="pl-k">string</span> <span class="pl-en">Type</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
        <span class="pl-k">public</span> DateTime <span class="pl-en">Date</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
        <span class="pl-k">public</span> <span class="pl-k">string</span> <span class="pl-en">Direction</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
        <span class="pl-k">public</span> String <span class="pl-en">Allocation</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
        <span class="pl-k">public</span> Double <span class="pl-en">Value</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }


    }


<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Allocation</span>
    {
        [BsonRepresentation(BsonType.ObjectId)]
        <span class="pl-k">public</span> ObjectId <span class="pl-en">Id</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
        <span class="pl-k">public</span> <span class="pl-k">string</span> <span class="pl-en">Name</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }
        <span class="pl-k">public</span> <span class="pl-k">string</span> <span class="pl-en">Description</span> { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }


    }</pre></div>

<p>We need to define a Data Context Object to interact with MongoDB:</p>

<div class="highlight highlight-c#"><pre>
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">IRRContext</span>
    {
        <span class="pl-k">public</span> <span class="pl-k">const</span> <span class="pl-k">string</span> CONNECTION_STRING_NAME = <span class="pl-s"><span class="pl-pds">"</span>IRR<span class="pl-pds">"</span></span>;
        <span class="pl-k">public</span> <span class="pl-k">const</span> <span class="pl-k">string</span> DATABASE_NAME = <span class="pl-s"><span class="pl-pds">"</span>irr<span class="pl-pds">"</span></span>;
        <span class="pl-k">public</span> <span class="pl-k">const</span> <span class="pl-k">string</span> IRRDEFINITIONS_COLLECTION_NAME = <span class="pl-s"><span class="pl-pds">"</span>irrdefinitions<span class="pl-pds">"</span></span>;
        <span class="pl-k">public</span> <span class="pl-k">const</span> <span class="pl-k">string</span> FLOWS_COLLECTION_NAME = <span class="pl-s"><span class="pl-pds">"</span>flows<span class="pl-pds">"</span></span>;

        <span class="pl-c">// This is ok... Normally, they would be put into</span>
        <span class="pl-c">// an IoC container.</span>
        <span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-k">readonly</span> IMongoClient _client;
        <span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-k">readonly</span> IMongoDatabase _database;

        <span class="pl-k">static</span> <span class="pl-en">IRRContext</span>()
        {
            <span class="pl-k">var</span> connectionString = ConfigurationManager.ConnectionStrings[CONNECTION_STRING_NAME].ConnectionString;
            _client = <span class="pl-k">new</span> MongoClient(connectionString);
            _database = _client.GetDatabase(DATABASE_NAME);
        }

        <span class="pl-k">public</span> IMongoClient Client
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> _client; }
        }

        <span class="pl-k">public</span> IMongoCollection&lt;IRRDefinition&gt; IRRDefinitions
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> _database.GetCollection&lt;IRRDefinition&gt;(IRRDEFINITIONS_COLLECTION_NAME); }
        }

        <span class="pl-k">public</span> IMongoCollection&lt;Flow&gt; Flows
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> _database.GetCollection&lt;Flow&gt;(FLOWS_COLLECTION_NAME); }
        }
    }
</pre></div>

<p>Source code is availlable on the repository for more informations, We will just be focused on interacting with MongoDb using MongoDb Driver. </p>

<div class="highlight highlight-c#"><pre><span class="pl-k">using</span> MongoDB.Bson;
<span class="pl-k">using</span> MongoDB.Bson.Serialization.Attributes;
<span class="pl-k">using</span> MongoDB.Driver;</pre></div>

<p>Connection String for mongodb database</p>

<div class="highlight highlight-c#"><pre> &lt;connectionStrings&gt;
    &lt;<span class="pl-k">add</span> name=<span class="pl-s"><span class="pl-pds">"</span>irr<span class="pl-pds">"</span></span> connectionString=<span class="pl-s"><span class="pl-pds">"</span>mongodb://localhost:27017<span class="pl-pds">"</span></span> /&gt;
  &lt;/connectionStrings&gt;</pre></div>

<h4>
<a id="crud-operations-using-mongodbnet-driver" class="anchor" href="#crud-operations-using-mongodbnet-driver" aria-hidden="true"><span class="octicon octicon-link"></span></a>CRUD Operations using MongoDB.Net Driver</h4>

<p>For this solution, I used:
<a href="https://www.visualstudio.com/en-us/products/visual-studio-community-vs.aspx">Visual studio Community 2015</a>
<a href="https://www.mongodb.org/downloads">Download MongoDB 3.0</a></p>

<p>For more reading about MongoDB .net Driver please visit :[C# and .NET MongoDB Driver]<a href="http://docs.mongodb.org/ecosystem/drivers/csharp/">http://docs.mongodb.org/ecosystem/drivers/csharp/</a>)</p>

<p>If you prefer to not use the automatic generator, push a branch named <code>gh-pages</code> to your repository to create a page manually. In addition to supporting regular HTML content, GitHub Pages support Jekyll, a simple, blog aware static site generator. Jekyll makes it easy to create site-wide headers and footers without having to copy them across every page. It also offers intelligent blog support and other advanced templating features.</p>

<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p>You can <a href="https://github.com/blog/821" class="user-mention">@mention</a> a GitHub username to generate a link to their profile. The resulting <code>&lt;a&gt;</code> element will link to the contributor’s GitHub Profile. For example: In 2007, Chris Wanstrath (<a href="https://github.com/defunkt" class="user-mention">@defunkt</a>), PJ Hyett (<a href="https://github.com/pjhyett" class="user-mention">@pjhyett</a>), and Tom Preston-Werner (<a href="https://github.com/mojombo" class="user-mention">@mojombo</a>) founded GitHub.</p>

<h3>
<a id="support-or-contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support or Contact</h3>

<p>Having trouble with Pages? Check out our <a href="https://help.github.com/pages">documentation</a> or <a href="https://github.com/contact">contact support</a> and we’ll help you sort it out.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/saidmohamedali/irrmongodb">IRR Calculation Using Mongodb and C# (.net)</a> is maintained by <a href="https://github.com/saidmohamedali">saidmohamedali</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
